{% extends 'base.html' %}
{% block content %}
<h1>Analysis Results</h1>

{% if table %}
    <h2>Filtered RS Table</h2>
    <div class="table-responsive">
        {{ table | safe }}
    </div>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
    <script>
        $(document).ready(function() {
            $('table').DataTable({
                "pageLength": 10,
                "lengthMenu": [5, 10, 25, 50]
            });
        });
    </script>
{% endif %}

{% if chart %}
    <h2>Relative Strength Chart</h2>
    {{ chart | safe }}
{% endif %}

{% if outperformance_chart %}
    <h2>Outperformance Since {{ reference_date }}</h2>
    {{ outperformance_chart | safe }}
{% endif %}

{% if stock_list %}
    <h2>Filtered Stocks List (RS Criteria)</h2>
    <pre>{{ stock_list }}</pre>
{% else %}
    <p>No stocks meet the RS criteria.</p>
{% endif %}

{% if outperforming_stocks %}
    <h2>Outperforming Stocks Since {{ reference_date }}</h2>
    <pre>{{ outperforming_stocks }}</pre>
{% else %}
    <p>No stocks outperformed the index since {{ reference_date }}.</p>
{% endif %}

{% if common_stocks %}
    <h2>Common Stocks in Both Lists</h2>
    <pre>{{ common_stocks }}</pre>
{% else %}
    <p>No common stocks between the filtered RS list and outperforming stocks.</p>
{% endif %}

{% if crossover_stocks %}
    <h2>Stocks with Recent RS Crossover Above Zero</h2>
    {% for key, stocks in crossover_stocks.items() %}
        <h3>{{ key.replace('_', ' ') }}</h3>
        <pre>{{ stocks | join(', ') }}</pre>
    {% endfor %}
{% else %}
    <p>No stocks with recent RS crossover above zero for the selected periods.</p>
{% endif %}

{% if common_crossover_stocks %}
    <h2>Common Stocks with Recent RS Crossover Above Zero Across All Specified Periods</h2>
    <pre>{{ common_crossover_stocks }}</pre>
{% else %}
    <p>No common stocks with recent RS crossover above zero across all specified periods.</p>
{% endif %}

<a href="/screener" class="btn btn-secondary mt-3">Back to Screener</a>
{% endblock %}